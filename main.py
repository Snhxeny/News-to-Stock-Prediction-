# -*- coding: utf-8 -*-
"""Final Project 4310.02.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1W7TB49vdvvwbuT6nnBp3BKi9zjOiTa2Y
"""

#Stock Estimation
#Code writen by Paul Cooney, 2024

#upload kaggle.jason api token
from google.colab import files

files.upload()

! mkdir ~/.kaggle
! cp kaggle.json ~/.kaggle/
! chmod 600 ~/.kaggle/kaggle.json

#installs and imports

!pip install radboud-el --q

from REL.mention_detection import MentionDetection
from REL.utils import process_results
from REL.entity_disambiguation import EntityDisambiguation
from REL.ner import Cmns, load_flair_ner

#download and extract REL model and files
!wget http://gem.cs.ru.nl/generic.tar.gz
!tar -xzvf "generic.tar.gz"
!rm "generic.tar.gz"

#dowraw_company_names extraraw_company_namesf 2014 wikipedia for REL.
#Itraw_company_namesused to test corrilation of postiveraw_company_namesatches to real companies
!wget http://gem.cs.ru.nl/wiki_2014.tar.gz
!tar -xzvf "wiki_2014.tar.gz"
!rm wiki_2014.tar.gz

#REL initialization
input_text = {
    "my_doc": (" ", []),
}
base_url = "/content/"
wiki_version = "wiki_2014"
config = {
    "mode": "eval",
    "model_path": "ed-wiki-2014",
}
mention_detection = MentionDetection(base_url, wiki_version)
tagger_ner = load_flair_ner("ner-fast")
tagger_ngram = Cmns(base_url, wiki_version, n=5)
mentions, n_mentions = mention_detection.find_mentions(input_text, tagger_ngram)
model = EntityDisambiguation(base_url, wiki_version, config)
predictions, timing = model.predict(mentions)
result = process_results(mentions, predictions, input_text)
print(result)

#install kaggle
!pip install -q kaggle

#get news files
!kaggle d download 'jeet2016/us-financial-news-articles'
!unzip us-financial-news-articles.zip
!rm us-financial-news-articles.zip

#Get filenames
import pandas as pd
import os
fileNames = []

for dirname, _, _filenames in os.walk('2018_01_112b52537b67659ad3609a234388c50a'):
    for filename in _filenames:
        if filename.lower().endswith((".json")):
          fileNames.append(os.path.join(dirname, filename))

#Preps newsdf
newsdf = pd.DataFrame()
dfs = []
for f in fileNames[0:]:
  data = pd.read_json(f, lines=True)
  dfs.append(data)
newsdf = pd.concat(dfs, ignore_index = True)
newsdf = newsdf[['title','text', 'author', 'published']]

#Named Entity Recognition method
def NER(text):
  mentions, n_mentions = mention_detection.find_mentions(text, tagger_ner)
  predictions, timing = model.predict(mentions)
  result = process_results(mentions, predictions, text)
  #print(result)
  return result

def UnbatchedNER(text):
  hold = {}
  hold[text] = (text, [])
  return NER(hold)

#Hardcoded Company Names
#companies the NER don't recognise were removed out

raw_company_names = []
raw_company_names.append("3M Company")
raw_company_names.append("A. O. Smith")
raw_company_names.append("Abbott Laboratories")
raw_company_names.append("AbbVie")
raw_company_names.append("Accenture")
raw_company_names.append("Adobe Inc.")
raw_company_names.append("Advanced Micro Devices")
raw_company_names.append("AES Corporation")
raw_company_names.append("Aflac")
raw_company_names.append("Agilent Technologies")
raw_company_names.append("Air Products")
raw_company_names.append("Airbnb")
raw_company_names.append("Akamai Technologies")
raw_company_names.append("Albemarle Corporation")
raw_company_names.append("Alexandria Real Estate Equities")
raw_company_names.append("Align Technology")
raw_company_names.append("Allegion")
raw_company_names.append("Alliant Energy")
raw_company_names.append("Allstate")
raw_company_names.append("Alphabet Inc.")
raw_company_names.append("Altria")
raw_company_names.append("Amazon")
raw_company_names.append("Amcor")
raw_company_names.append("Ameren")
raw_company_names.append("American Airlines Group")
raw_company_names.append("American Electric Power")
raw_company_names.append("American Express")
raw_company_names.append("American International Group")
raw_company_names.append("American Tower")
raw_company_names.append("American Water Works")
raw_company_names.append("Allstate")
raw_company_names.append("Ameriprise Financial")
raw_company_names.append("Ametek")
raw_company_names.append("Amgen")
raw_company_names.append("Amphenol")
raw_company_names.append("Analog Devices")
raw_company_names.append("Ansys")
raw_company_names.append("Aon")
raw_company_names.append("APA Corporation")
raw_company_names.append("Apple Inc.")
raw_company_names.append("Applied Materials")
raw_company_names.append("Aptiv")
raw_company_names.append("Arch Capital Group")
raw_company_names.append("Archer Daniels Midland")
raw_company_names.append("Arista Networks")
raw_company_names.append("Arthur J. Gallagher & Co.")
raw_company_names.append("Assurant")
raw_company_names.append("AT&T")
raw_company_names.append("Atmos Energy")
raw_company_names.append("Autodesk")
raw_company_names.append("Automatic Data Processing")
raw_company_names.append("AutoZone")
raw_company_names.append("AvalonBay Communities")
raw_company_names.append("Avery Dennison")
raw_company_names.append("Axon Enterprise")
raw_company_names.append("Baker Hughes")
raw_company_names.append("Ball Corporation")
raw_company_names.append("Bank of America")
raw_company_names.append("BNY Mellon")
raw_company_names.append("Bath & Body Works, Inc.")
raw_company_names.append("Baxter International")
raw_company_names.append("Becton Dickinson")
raw_company_names.append("Berkshire Hathaway")
raw_company_names.append("Best Buy")
raw_company_names.append("Bio-Rad Laboratories")
raw_company_names.append("Bio-Techne")
raw_company_names.append("Biogen")
raw_company_names.append("BlackRock")
raw_company_names.append("Blackstone Inc.")
raw_company_names.append("Boeing")
raw_company_names.append("Booking Holdings")
raw_company_names.append("BorgWarner")
raw_company_names.append("Boston Scientific")
raw_company_names.append("Bristol Myers Squibb")
raw_company_names.append("Broadcom")
raw_company_names.append("Broadridge Financial Solutions")
raw_company_names.append("Brown & Brown")
#raw_company_names.append("Brown–Forman") #Confuses NER
raw_company_names.append("Builders FirstSource")
raw_company_names.append("Bunge Global")
raw_company_names.append("BXP, Inc.")
#raw_company_names.append("C.H. Robinson") #NER confuses this with a person
raw_company_names.append("Cadence Design Systems")
raw_company_names.append("Caesars Entertainment")
raw_company_names.append("Camden Property Trust")
raw_company_names.append("Campbell Soup Company")
raw_company_names.append("Capital One")
raw_company_names.append("Cardinal Health")
raw_company_names.append("CarMax")
raw_company_names.append("Carnival")
raw_company_names.append("Carrier Global")
raw_company_names.append("Catalent")
raw_company_names.append("Caterpillar Inc.")
raw_company_names.append("Cboe Global Markets")
raw_company_names.append("CBRE Group")
raw_company_names.append("CDW")
raw_company_names.append("Celanese")
raw_company_names.append("Cencora")
raw_company_names.append("Centene Corporation")
raw_company_names.append("CenterPoint Energy")
raw_company_names.append("CF Industries")
raw_company_names.append("Charles River Laboratories")
raw_company_names.append("Charles Schwab Corporation")
raw_company_names.append("Charter Communications")
raw_company_names.append("Chevron Corporation")
raw_company_names.append("Chipotle Mexican Grill")
raw_company_names.append("Chubb Limited")
raw_company_names.append("Church & Dwight")
raw_company_names.append("Cigna")
raw_company_names.append("Cincinnati Financial")
raw_company_names.append("Cintas")
raw_company_names.append("Cisco")
raw_company_names.append("Citigroup")
raw_company_names.append("Citizens Financial Group")
raw_company_names.append("Clorox")
raw_company_names.append("CME Group")
raw_company_names.append("CMS Energy")
raw_company_names.append("Coca-Cola Company (The)")
raw_company_names.append("Cognizant")
raw_company_names.append("Colgate-Palmolive")
raw_company_names.append("Comcast")
raw_company_names.append("Conagra Brands")
raw_company_names.append("ConocoPhillips")
raw_company_names.append("Consolidated Edison")
raw_company_names.append("Constellation Brands")
raw_company_names.append("Constellation Energy")
raw_company_names.append("Cooper company (The)")
raw_company_names.append("Copart")
raw_company_names.append("Corning Inc.")
raw_company_names.append("Corpay")
raw_company_names.append("Corteva")
raw_company_names.append("CoStar Group")
raw_company_names.append("Costco")
raw_company_names.append("Coterra")
raw_company_names.append("CrowdStrike")
raw_company_names.append("Crown Castle")
raw_company_names.append("CSX Corporation")
raw_company_names.append("Cummins")
raw_company_names.append("CVS Health")
raw_company_names.append("Danaher Corporation")
raw_company_names.append("Darden Restaurants")
raw_company_names.append("DaVita")
raw_company_names.append("Dayforce")
raw_company_names.append("Deckers Brands")
raw_company_names.append("Deere & Company")
raw_company_names.append("Delta Air Lines")
raw_company_names.append("Devon Energy")
raw_company_names.append("Dexcom")
raw_company_names.append("Diamondback Energy")
raw_company_names.append("Digital Realty")
raw_company_names.append("Discover Financial")
raw_company_names.append("Dollar General")
raw_company_names.append("Dollar Tree")
raw_company_names.append("Dominion Energy")
raw_company_names.append("Domino's")
raw_company_names.append("Dover Corporation")
raw_company_names.append("Dow Inc.")
#raw_company_names.append("DR Horton") #Person
raw_company_names.append("DTE Energy")
raw_company_names.append("Duke Energy")
raw_company_names.append("DuPont")
raw_company_names.append("Eastman Chemical Company")
raw_company_names.append("Eaton Corporation")
raw_company_names.append("eBay")
raw_company_names.append("Ecolab")
raw_company_names.append("Edison International")
raw_company_names.append("Edwards Lifesciences")
raw_company_names.append("Electronic Arts")
raw_company_names.append("Elevance Health")
raw_company_names.append("Emerson Electric")
raw_company_names.append("Enphase")
raw_company_names.append("Entergy")
raw_company_names.append("EOG Resources")
raw_company_names.append("EPAM Systems")
raw_company_names.append("EQT Corporation")
raw_company_names.append("Equifax")
raw_company_names.append("Equinix")
raw_company_names.append("Equity Residential")
raw_company_names.append("Essex Property Trust")
raw_company_names.append("Estée Lauder company (The)")
raw_company_names.append("Etsy")
raw_company_names.append("Everest Re")
raw_company_names.append("Evergy")
raw_company_names.append("Eversource")
raw_company_names.append("Exelon")
raw_company_names.append("Expedia Group")
raw_company_names.append("Expeditors International")
raw_company_names.append("Extra Space Storage")
raw_company_names.append("ExxonMobil")
raw_company_names.append("F5, Inc.")
raw_company_names.append("FactSet")
raw_company_names.append("Fair Isaac")
raw_company_names.append("Fastenal")
raw_company_names.append("Federal Realty")
raw_company_names.append("FedEx")
raw_company_names.append("Fidelity National Information Services")
raw_company_names.append("Fifth Third Bank")
raw_company_names.append("First Solar")
raw_company_names.append("FirstEnergy")
raw_company_names.append("Fiserv")
raw_company_names.append("FMC Corporation")
raw_company_names.append("Ford Motor Company")
raw_company_names.append("Fortinet")
raw_company_names.append("Fortive")
#raw_company_names.append("Fox Corporation (Class A)")
#raw_company_names.append("Fox Corporation (Class B)")
raw_company_names.append("Fox Corporation") #dosn't differentiate
#raw_company_names.append("Franklin Templeton") #Person
raw_company_names.append("Freeport-McMoRan")
raw_company_names.append("Garmin")
raw_company_names.append("Gartner")
raw_company_names.append("GE Aerospace")
raw_company_names.append("GE HealthCare")
raw_company_names.append("GE Vernova")
raw_company_names.append("Gen Digital")
raw_company_names.append("Generac")
raw_company_names.append("General Dynamics")
#raw_company_names.append("General Mills") #Person
raw_company_names.append("General Motors")
raw_company_names.append("Genuine Parts Company")
raw_company_names.append("Gilead Sciences")
raw_company_names.append("Global Payments")
raw_company_names.append("Globe Life")
raw_company_names.append("GoDaddy")
raw_company_names.append("Goldman Sachs")
raw_company_names.append("Halliburton")
raw_company_names.append("Hartford (The)")
raw_company_names.append("Hasbro")
raw_company_names.append("HCA Healthcare")
raw_company_names.append("Healthpeak Properties")
#raw_company_names.append("Henry Schein") #Person
raw_company_names.append("Hershey Company (The)")
raw_company_names.append("Hess Corporation")
#raw_company_names.append("Hewlett Packard Enterprise")
raw_company_names.append("Hilton Worldwide")
raw_company_names.append("Hologic")
raw_company_names.append("Home Depot (The)")
raw_company_names.append("Honeywell")
raw_company_names.append("Hormel Foods")
raw_company_names.append("Host Hotels & Resorts")
raw_company_names.append("Howmet Aerospace")
raw_company_names.append("HP Inc.")
raw_company_names.append("Hubbell Incorporated")
raw_company_names.append("Humana")
raw_company_names.append("Huntington Bancshares")
raw_company_names.append("Huntington Ingalls Industries")
raw_company_names.append("IBM")
raw_company_names.append("IDEX Corporation")
raw_company_names.append("Idexx Laboratories")
raw_company_names.append("Illinois Tool Works")
raw_company_names.append("Incyte")
raw_company_names.append("Ingersoll Rand")
raw_company_names.append("Insulet Corporation")
raw_company_names.append("Intel")
raw_company_names.append("Intercontinental Exchange")
raw_company_names.append("International Flavors & Fragrances")
raw_company_names.append("International Paper")
raw_company_names.append("Interpublic Group of raw_company_names (The)")
raw_company_names.append("Intuit")
raw_company_names.append("Intuitive Surgical")
raw_company_names.append("Invesco")
raw_company_names.append("Invitation Homes")
raw_company_names.append("IQVIA")
raw_company_names.append("Iron Mountain")
raw_company_names.append("J.B. Hunt")
raw_company_names.append("Jabil")
raw_company_names.append("Jack Henry & Associates")
#raw_company_names.append("Jacobs Solutions")
raw_company_names.append("Johnson & Johnson")
raw_company_names.append("Johnson Controls")
raw_company_names.append("JPMorgan Chase")
raw_company_names.append("Juniper Networks")
raw_company_names.append("Kellanova")
raw_company_names.append("Kenvue")
#raw_company_names.append("Keurig Dr Pepper")
raw_company_names.append("KeyCorp")
raw_company_names.append("Keysight")
raw_company_names.append("Kimberly-Clark")
raw_company_names.append("Kimco Realty")
#raw_company_names.append("Kinder Morgan") #Confuses with person
raw_company_names.append("KKR")
raw_company_names.append("KLA Corporation")
raw_company_names.append("Kraft Heinz")
raw_company_names.append("Kroger")
raw_company_names.append("L3Harris")
raw_company_names.append("LabCorp")
raw_company_names.append("Lam Research")
#raw_company_names.append("Lamb Weston") #person
raw_company_names.append("Las Vegas Sands")
#raw_company_names.append("Leidos") #Person
raw_company_names.append("Lennar")
#raw_company_names.append("Lilly (Eli)") #Verry confusing for NER
raw_company_names.append("Linde plc")
raw_company_names.append("Live Nation Entertainment")
raw_company_names.append("LKQ Corporation")
raw_company_names.append("Lockheed Martin")
raw_company_names.append("Loews Corporation")
raw_company_names.append("Lowe's")
raw_company_names.append("Lululemon Athletica")
raw_company_names.append("LyondellBasell")
raw_company_names.append("M&T Bank")
raw_company_names.append("Marathon Oil")
raw_company_names.append("Marathon Petroleum")
raw_company_names.append("MarketAxess")
raw_company_names.append("Marriott International")
#raw_company_names.append("Marsh McLennan") #Person
raw_company_names.append("Martin Marietta Materials")
#raw_company_names.append("Masco") #Person
raw_company_names.append("Mastercard")
raw_company_names.append("Match Group")
raw_company_names.append("McCormick & Company")
raw_company_names.append("McDonald's")
raw_company_names.append("McKesson Corporation")
raw_company_names.append("Medtronic")
raw_company_names.append("Merck & Co.")
raw_company_names.append("Meta Platforms")
raw_company_names.append("MetLife")
raw_company_names.append("Mettler Toledo")
raw_company_names.append("MGM Resorts")
raw_company_names.append("Microchip Technology")
raw_company_names.append("Micron Technology")
raw_company_names.append("Microsoft")
raw_company_names.append("Mid-America Apartment Communities")
raw_company_names.append("Moderna")
raw_company_names.append("Mohawk Industries")
raw_company_names.append("Molina Healthcare")
raw_company_names.append("Molson Coors Beverage Company")
raw_company_names.append("Mondelez International")
raw_company_names.append("Monolithic Power Systems")
raw_company_names.append("Monster Beverage")
raw_company_names.append("Moody's Corporation")
#raw_company_names.append("Morgan Stanley") Person
raw_company_names.append("Mosaic Company (The)")
raw_company_names.append("Motorola Solutions")
raw_company_names.append("MSCI")
raw_company_names.append("Nasdaq, Inc.")
raw_company_names.append("NetApp")
raw_company_names.append("Netflix")
raw_company_names.append("Newmont")
#raw_company_names.append("News Corp (Class A)")
#raw_company_names.append("News Corp (Class B)")
raw_company_names.append("News Corp") #Combined
raw_company_names.append("NextEra Energy")
raw_company_names.append("Nike, Inc.")
raw_company_names.append("NiSource")
raw_company_names.append("Nordson Corporation")
raw_company_names.append("Norfolk Southern Railway")
raw_company_names.append("Northern Trust")
raw_company_names.append("Northrop Grumman")
raw_company_names.append("Norwegian Cruise Line Holdings")
raw_company_names.append("NRG Energy")
raw_company_names.append("Nucor")
raw_company_names.append("Nvidia")
raw_company_names.append("NVR, Inc.")
raw_company_names.append("NXP Semiconductors")
raw_company_names.append("O'Reilly Auto Parts")
raw_company_names.append("Occidental Petroleum")
raw_company_names.append("Old Dominion")
raw_company_names.append("Omnicom Group")
raw_company_names.append("ON Semiconductor")
raw_company_names.append("ONEOK")
raw_company_names.append("Oracle Corporation")
raw_company_names.append("Otis Worldwide")
raw_company_names.append("Paccar")
raw_company_names.append("Packaging Corporation of America")
raw_company_names.append("Palo Alto Networks")
raw_company_names.append("Paramount Global")
raw_company_names.append("Parker Hannifin")
raw_company_names.append("Paychex")
raw_company_names.append("Paycom")
raw_company_names.append("PayPal")
raw_company_names.append("Pentair")
raw_company_names.append("PepsiCo")
raw_company_names.append("Pfizer")
raw_company_names.append("PG&E Corporation")
raw_company_names.append("Philip Morris International")
#raw_company_names.append("Phillips 66") #Person, somehow
raw_company_names.append("Pinnacle West")
raw_company_names.append("PNC Financial Services")
raw_company_names.append("Pool Corporation")
raw_company_names.append("PPG Industries")
raw_company_names.append("PPL Corporation")
raw_company_names.append("Principal Financial Group")
raw_company_names.append("Procter & Gamble")
raw_company_names.append("Progressive Corporation")
raw_company_names.append("Prologis")
raw_company_names.append("Prudential Financial")
raw_company_names.append("Public Service Enterprise Group")
raw_company_names.append("PTC")
raw_company_names.append("Public Storage")
raw_company_names.append("PulteGroup")
raw_company_names.append("Qorvo")
raw_company_names.append("Quanta Services")
raw_company_names.append("Qualcomm")
raw_company_names.append("Quest Diagnostics")
raw_company_names.append("Ralph Lauren Corporation")
#raw_company_names.append("Raymond James") #Person
raw_company_names.append("RTX Corporation")
raw_company_names.append("Realty Income")
raw_company_names.append("Regency Centers")
raw_company_names.append("Regeneron")
raw_company_names.append("Regions Financial Corporation")
raw_company_names.append("Republic Services")
raw_company_names.append("ResMed")
raw_company_names.append("Revvity")
raw_company_names.append("Rockwell Automation")
raw_company_names.append("Rollins, Inc.")
raw_company_names.append("Roper Technologies")
#raw_company_names.append("Ross Stores") #Person
raw_company_names.append("Royal Caribbean Group")
raw_company_names.append("S&P Global")
raw_company_names.append("Salesforce")
raw_company_names.append("SBA Communications")
raw_company_names.append("Schlumberger")
raw_company_names.append("Seagate Technology")
raw_company_names.append("Sempra")
raw_company_names.append("ServiceNow")
raw_company_names.append("Sherwin-Williams")
raw_company_names.append("Simon Property Group")
raw_company_names.append("Skyworks Solutions")
raw_company_names.append("J.M. Smucker Company (The)")
raw_company_names.append("Smurfit WestRock")
raw_company_names.append("Snap-on")
raw_company_names.append("Solventum")
raw_company_names.append("Southern Company")
raw_company_names.append("Southwest Airlines")
raw_company_names.append("Stanley Black & Decker")
raw_company_names.append("Starbucks")
raw_company_names.append("State Street Corporation")
raw_company_names.append("Steel Dynamics")
raw_company_names.append("Steris")
raw_company_names.append("Stryker Corporation")
raw_company_names.append("Supermicro")
raw_company_names.append("Synchrony Financial")
raw_company_names.append("Synopsys")
raw_company_names.append("Sysco")
raw_company_names.append("T-Mobile US")
#raw_company_names.append("T. Rowe Price") #Person
raw_company_names.append("Take-Two Interactive")
raw_company_names.append("Tapestry, Inc.")
raw_company_names.append("Targa Resources")
raw_company_names.append("Target Corporation")
raw_company_names.append("TE Connectivity")
raw_company_names.append("Teledyne Technologies")
raw_company_names.append("Teleflex")
raw_company_names.append("Teradyne")
raw_company_names.append("Tesla, Inc.")
raw_company_names.append("Texas Instruments")
raw_company_names.append("Textron")
raw_company_names.append("Thermo Fisher Scientific")
raw_company_names.append("TJX company")
raw_company_names.append("Tractor Supply")
raw_company_names.append("Trane Technologies")
raw_company_names.append("TransDigm Group")
raw_company_names.append("Travelers company (The)")
raw_company_names.append("Trimble Inc.")
raw_company_names.append("Truist")
raw_company_names.append("Tyler Technologies")
#raw_company_names.append("Tyson Foods") #Person
raw_company_names.append("U.S. Bank")
raw_company_names.append("Uber")
raw_company_names.append("UDR, Inc.")
raw_company_names.append("Ulta Beauty")
raw_company_names.append("Union Pacific Corporation")
raw_company_names.append("United Airlines Holdings")
raw_company_names.append("United Parcel Service")
raw_company_names.append("United Rentals")
raw_company_names.append("UnitedHealth Group")
raw_company_names.append("Universal Health Services")
raw_company_names.append("Valero Energy")
raw_company_names.append("Ventas")
raw_company_names.append("Veralto")
raw_company_names.append("Verisign")
raw_company_names.append("Verisk")
raw_company_names.append("Verizon")
raw_company_names.append("Vertex Pharmaceuticals")
raw_company_names.append("Viatris")
raw_company_names.append("Vici Properties")
raw_company_names.append("Visa Inc.")
raw_company_names.append("Vistra")
raw_company_names.append("Vulcan Materials Company")
raw_company_names.append("W. R. Berkley Corporation")
#raw_company_names.append("W. W. Grainger") #Person
raw_company_names.append("Wabtec")
raw_company_names.append("Walgreens Boots Alliance")
raw_company_names.append("Walmart")
raw_company_names.append("Walt Disney Company (The)")
raw_company_names.append("Warner Bros. Discovery")
raw_company_names.append("Waste Management")
raw_company_names.append("Waters Corporation")
raw_company_names.append("WEC Energy Group")
raw_company_names.append("Wells Fargo")
raw_company_names.append("Welltower")
raw_company_names.append("West Pharmaceutical Services")
raw_company_names.append("Western Digital")
raw_company_names.append("Weyerhaeuser")
raw_company_names.append("Williams Compnay")
raw_company_names.append("Willis Towers Watson")
raw_company_names.append("Wynn Resorts")
raw_company_names.append("Xcel Energy")
raw_company_names.append("Xylem Inc.")
raw_company_names.append("Yum! Brands")
raw_company_names.append("Zebra Technologies")
raw_company_names.append("Zimmer Biomet")
raw_company_names.append("Zoetis")
NER_company_names = []
raw_to_NER = {}

#print(raw_company_names)
for c in raw_company_names:
  text = {}
  text[c] = (c, [])
  b = NER(text)
  if(len(b)==0):
    continue
  key = next(iter(b))
  b = b[key]
  b=b[0]
  b=b[3]
  raw_to_NER[c] = b
  NER_company_names = NER_company_names + [b]

#Hardcoded Company Codes
raw_to_stockCode = {}
raw_to_stockCode["3M Company"] = "MMM"
raw_to_stockCode["A. O. Smith"] = "AOS"
raw_to_stockCode["Abbott Laboratories"] = "ABT"
raw_to_stockCode["AbbVie"] = "ABBV"
raw_to_stockCode["Accenture"] = "ACN"
raw_to_stockCode["Adobe Inc."] = "ADBE"
raw_to_stockCode["Advanced Micro Devices"] = "AMD"
raw_to_stockCode["AES Corporation"] = "AES"
raw_to_stockCode["Aflac"] = "AFL"
raw_to_stockCode["Agilent Technologies"] = "A"
raw_to_stockCode["Air Products"] = "APD"
raw_to_stockCode["Airbnb"] = "ABNB"
raw_to_stockCode["Akamai Technologies"] = "AKAM"
raw_to_stockCode["Albemarle Corporation"] = "ALB"
raw_to_stockCode["Alexandria Real Estate Equities"] = "ARE"
raw_to_stockCode["Align Technology"] = "ALGN"
raw_to_stockCode["Allegion"] = "ALLE"
raw_to_stockCode["Alliant Energy"] = "LNT"
raw_to_stockCode["Allstate"] = "ALL"
raw_to_stockCode["Alphabet Inc. (Class A)"] = "GOOGL"
raw_to_stockCode["Alphabet Inc. (Class C)"] = "GOOG"
raw_to_stockCode["Altria"] = "MO"
raw_to_stockCode["Amazon"] = "AMZN"
raw_to_stockCode["Amcor"] = "AMCR"
raw_to_stockCode["Ameren"] = "AEE"
raw_to_stockCode["American Airlines Group"] = "AAL"
raw_to_stockCode["American Electric Power"] = "AEP"
raw_to_stockCode["American Express"] = "AXP"
raw_to_stockCode["American International Group"] = "AIG"
raw_to_stockCode["American Tower"] = "AMT"
raw_to_stockCode["American Water Works"] = "AWK"
raw_to_stockCode["Ameriprise Financial"] = "AMP"
raw_to_stockCode["Ametek"] = "AME"
raw_to_stockCode["Amgen"] = "AMGN"
raw_to_stockCode["Amphenol"] = "APH"
raw_to_stockCode["Analog Devices"] = "ADI"
raw_to_stockCode["Ansys"] = "ANSS"
raw_to_stockCode["Aon"] = "AON"
raw_to_stockCode["APA Corporation"] = "APA"
raw_to_stockCode["Apple Inc."] = "AAPL"
raw_to_stockCode["Applied Materials"] = "AMAT"
raw_to_stockCode["Aptiv"] = "APTV"
raw_to_stockCode["Arch Capital Group"] = "ACGL"
raw_to_stockCode["Archer Daniels Midland"] = "ADM"
raw_to_stockCode["Arista Networks"] = "ANET"
raw_to_stockCode["Arthur J. Gallagher & Co."] = "AJG"
raw_to_stockCode["Assurant"] = "AIZ"
raw_to_stockCode["AT&T"] = "T"
raw_to_stockCode["Atmos Energy"] = "ATO"
raw_to_stockCode["Autodesk"] = "ADSK"
raw_to_stockCode["Automatic Data Processing"] = "ADP"
raw_to_stockCode["AutoZone"] = "AZO"
raw_to_stockCode["AvalonBay Communities"] = "AVB"
raw_to_stockCode["Avery Dennison"] = "AVY"
raw_to_stockCode["Axon Enterprise"] = "AXON"
raw_to_stockCode["Baker Hughes"] = "BKR"
raw_to_stockCode["Ball Corporation"] = "BALL"
raw_to_stockCode["Bank of America"] = "BAC"
raw_to_stockCode["BNY Mellon"] = "BK"
raw_to_stockCode["Bath & Body Works, Inc."] = "BBWI"
raw_to_stockCode["Baxter International"] = "BAX"
raw_to_stockCode["Becton Dickinson"] = "BDX"
raw_to_stockCode["Berkshire Hathaway"] = "BRK.B"
raw_to_stockCode["Best Buy"] = "BBY"
raw_to_stockCode["Bio-Rad Laboratories"] = "BIO"
raw_to_stockCode["Bio-Techne"] = "TECH"
raw_to_stockCode["Biogen"] = "BIIB"
raw_to_stockCode["BlackRock"] = "BLK"
raw_to_stockCode["Blackstone Inc."] = "BX"
raw_to_stockCode["Boeing"] = "BA"
raw_to_stockCode["Booking Holdings"] = "BKNG"
raw_to_stockCode["BorgWarner"] = "BWA"
raw_to_stockCode["Boston Scientific"] = "BSX"
raw_to_stockCode["Bristol Myers Squibb"] = "BMY"
raw_to_stockCode["Broadcom"] = "AVGO"
raw_to_stockCode["Broadridge Financial Solutions"] = "BR"
raw_to_stockCode["Brown & Brown"] = "BRO"
raw_to_stockCode["Brown–Forman"] = "BF.B"
raw_to_stockCode["Builders FirstSource"] = "BLDR"
raw_to_stockCode["Bunge Global"] = "BG"
raw_to_stockCode["BXP, Inc."] = "BXP"
raw_to_stockCode["C.H. Robinson"] = "CHRW"
raw_to_stockCode["Cadence Design Systems"] = "CDNS"
raw_to_stockCode["Caesars Entertainment"] = "CZR"
raw_to_stockCode["Camden Property Trust"] = "CPT"
raw_to_stockCode["Campbell Soup Company"] = "CPB"
raw_to_stockCode["Capital One"] = "COF"
raw_to_stockCode["Cardinal Health"] = "CAH"
raw_to_stockCode["CarMax"] = "KMX"
raw_to_stockCode["Carnival"] = "CCL"
raw_to_stockCode["Carrier Global"] = "CARR"
raw_to_stockCode["Catalent"] = "CTLT"
raw_to_stockCode["Caterpillar Inc."] = "CAT"
raw_to_stockCode["Cboe Global Markets"] = "CBOE"
raw_to_stockCode["CBRE Group"] = "CBRE"
raw_to_stockCode["CDW"] = "CDW"
raw_to_stockCode["Celanese"] = "CE"
raw_to_stockCode["Cencora"] = "COR"
raw_to_stockCode["Centene Corporation"] = "CNC"
raw_to_stockCode["CenterPoint Energy"] = "CNP"
raw_to_stockCode["CF Industries"] = "CF"
raw_to_stockCode["Charles River Laboratories"] = "CRL"
raw_to_stockCode["Charles Schwab Corporation"] = "SCHW"
raw_to_stockCode["Charter Communications"] = "CHTR"
raw_to_stockCode["Chevron Corporation"] = "CVX"
raw_to_stockCode["Chipotle Mexican Grill"] = "CMG"
raw_to_stockCode["Chubb Limited"] = "CB"
raw_to_stockCode["Church & Dwight"] = "CHD"
raw_to_stockCode["Cigna"] = "CI"
raw_to_stockCode["Cincinnati Financial"] = "CINF"
raw_to_stockCode["Cintas"] = "CTAS"
raw_to_stockCode["Cisco"] = "CSCO"
raw_to_stockCode["Citigroup"] = "C"
raw_to_stockCode["Citizens Financial Group"] = "CFG"
raw_to_stockCode["Clorox"] = "CLX"
raw_to_stockCode["CME Group"] = "CME"
raw_to_stockCode["CMS Energy"] = "CMS"
raw_to_stockCode["Coca-Cola Company (The)"] = "KO"
raw_to_stockCode["Cognizant"] = "CTSH"
raw_to_stockCode["Colgate-Palmolive"] = "CL"
raw_to_stockCode["Comcast"] = "CMCSA"
raw_to_stockCode["Conagra Brands"] = "CAG"
raw_to_stockCode["ConocoPhillips"] = "COP"
raw_to_stockCode["Consolidated Edison"] = "ED"
raw_to_stockCode["Constellation Brands"] = "STZ"
raw_to_stockCode["Constellation Energy"] = "CEG"
raw_to_stockCode["Cooper Companies (The)"] = "COO"
raw_to_stockCode["Copart"] = "CPRT"
raw_to_stockCode["Corning Inc."] = "GLW"
raw_to_stockCode["Corpay"] = "CPAY"
raw_to_stockCode["Corteva"] = "CTVA"
raw_to_stockCode["CoStar Group"] = "CSGP"
raw_to_stockCode["Costco"] = "COST"
raw_to_stockCode["Coterra"] = "CTRA"
raw_to_stockCode["CrowdStrike"] = "CRWD"
raw_to_stockCode["Crown Castle"] = "CCI"
raw_to_stockCode["CSX Corporation"] = "CSX"
raw_to_stockCode["Cummins"] = "CMI"
raw_to_stockCode["CVS Health"] = "CVS"
raw_to_stockCode["Danaher Corporation"] = "DHR"
raw_to_stockCode["Darden Restaurants"] = "DRI"
raw_to_stockCode["DaVita"] = "DVA"
raw_to_stockCode["Dayforce"] = "DAY"
raw_to_stockCode["Deckers Brands"] = "DECK"
raw_to_stockCode["Deere & Company"] = "DE"
raw_to_stockCode["Delta Air Lines"] = "DAL"
raw_to_stockCode["Devon Energy"] = "DVN"
raw_to_stockCode["Dexcom"] = "DXCM"
raw_to_stockCode["Diamondback Energy"] = "FANG"
raw_to_stockCode["Digital Realty"] = "DLR"
raw_to_stockCode["Discover Financial"] = "DFS"
raw_to_stockCode["Dollar General"] = "DG"
raw_to_stockCode["Dollar Tree"] = "DLTR"
raw_to_stockCode["Dominion Energy"] = "D"
raw_to_stockCode["Domino's"] = "DPZ"
raw_to_stockCode["Dover Corporation"] = "DOV"
raw_to_stockCode["Dow Inc."] = "DOW"
raw_to_stockCode["DR Horton"] = "DHI"
raw_to_stockCode["DTE Energy"] = "DTE"
raw_to_stockCode["Duke Energy"] = "DUK"
raw_to_stockCode["DuPont"] = "DD"
raw_to_stockCode["Eastman Chemical Company"] = "EMN"
raw_to_stockCode["Eaton Corporation"] = "ETN"
raw_to_stockCode["eBay"] = "EBAY"
raw_to_stockCode["Ecolab"] = "ECL"
raw_to_stockCode["Edison International"] = "EIX"
raw_to_stockCode["Edwards Lifesciences"] = "EW"
raw_to_stockCode["Electronic Arts"] = "EA"
raw_to_stockCode["Elevance Health"] = "ELV"
raw_to_stockCode["Emerson Electric"] = "EMR"
raw_to_stockCode["Enphase"] = "ENPH"
raw_to_stockCode["Entergy"] = "ETR"
raw_to_stockCode["EOG Resources"] = "EOG"
raw_to_stockCode["EPAM Systems"] = "EPAM"
raw_to_stockCode["EQT Corporation"] = "EQT"
raw_to_stockCode["Equifax"] = "EFX"
raw_to_stockCode["Equinix"] = "EQIX"
raw_to_stockCode["Equity Residential"] = "EQR"
raw_to_stockCode["Essex Property Trust"] = "ESS"
raw_to_stockCode["Estée Lauder Companies (The)"] = "EL"
raw_to_stockCode["Etsy"] = "ETSY"
raw_to_stockCode["Everest Re"] = "EG"
raw_to_stockCode["Evergy"] = "EVRG"
raw_to_stockCode["Eversource"] = "ES"
raw_to_stockCode["Exelon"] = "EXC"
raw_to_stockCode["Expedia Group"] = "EXPE"
raw_to_stockCode["Expeditors International"] = "EXPD"
raw_to_stockCode["Extra Space Storage"] = "EXR"
raw_to_stockCode["ExxonMobil"] = "XOM"
raw_to_stockCode["F5, Inc."] = "FFIV"
raw_to_stockCode["FactSet"] = "FDS"
raw_to_stockCode["Fair Isaac"] = "FICO"
raw_to_stockCode["Fastenal"] = "FAST"
raw_to_stockCode["Federal Realty"] = "FRT"
raw_to_stockCode["FedEx"] = "FDX"
raw_to_stockCode["Fidelity National Information Services"] = "FIS"
raw_to_stockCode["Fifth Third Bank"] = "FITB"
raw_to_stockCode["First Solar"] = "FSLR"
raw_to_stockCode["FirstEnergy"] = "FE"
raw_to_stockCode["Fiserv"] = "FI"
raw_to_stockCode["FMC Corporation"] = "FMC"
raw_to_stockCode["Ford Motor Company"] = "F"
raw_to_stockCode["Fortinet"] = "FTNT"
raw_to_stockCode["Fortive"] = "FTV"
raw_to_stockCode["Fox Corporation"] = "FOX"
raw_to_stockCode["Franklin Templeton"] = "BEN"
raw_to_stockCode["Freeport-McMoRan"] = "FCX"
raw_to_stockCode["Garmin"] = "GRMN"
raw_to_stockCode["Gartner"] = "IT"
raw_to_stockCode["GE Aerospace"] = "GE"
raw_to_stockCode["GE HealthCare"] = "GEHC"
raw_to_stockCode["GE Vernova"] = "GEV"
raw_to_stockCode["Gen Digital"] = "GEN"
raw_to_stockCode["Generac"] = "GNRC"
raw_to_stockCode["General Dynamics"] = "GD"
raw_to_stockCode["General Mills"] = "GIS"
raw_to_stockCode["General Motors"] = "GM"
raw_to_stockCode["Genuine Parts Company"] = "GPC"
raw_to_stockCode["Gilead Sciences"] = "GILD"
raw_to_stockCode["Global Payments"] = "GPN"
raw_to_stockCode["Globe Life"] = "GL"
raw_to_stockCode["GoDaddy"] = "GDDY"
raw_to_stockCode["Goldman Sachs"] = "GS"
raw_to_stockCode["Halliburton"] = "HAL"
raw_to_stockCode["Hartford (The)"] = "HIG"
raw_to_stockCode["Hasbro"] = "HAS"
raw_to_stockCode["HCA Healthcare"] = "HCA"
raw_to_stockCode["Healthpeak Properties"] = "DOC"
raw_to_stockCode["Henry Schein"] = "HSIC"
raw_to_stockCode["Hershey Company (The)"] = "HSY"
raw_to_stockCode["Hess Corporation"] = "HES"
raw_to_stockCode["Hewlett Packard Enterprise"] = "HPE"
raw_to_stockCode["Hilton Worldwide"] = "HLT"
raw_to_stockCode["Hologic"] = "HOLX"
raw_to_stockCode["Home Depot (The)"] = "HD"
raw_to_stockCode["Honeywell"] = "HON"
raw_to_stockCode["Hormel Foods"] = "HRL"
raw_to_stockCode["Host Hotels & Resorts"] = "HST"
raw_to_stockCode["Howmet Aerospace"] = "HWM"
raw_to_stockCode["HP Inc."] = "HPQ"
raw_to_stockCode["Hubbell Incorporated"] = "HUBB"
raw_to_stockCode["Humana"] = "HUM"
raw_to_stockCode["Huntington Bancshares"] = "HBAN"
raw_to_stockCode["Huntington Ingalls Industries"] = "HII"
raw_to_stockCode["IBM"] = "IBM"
raw_to_stockCode["IDEX Corporation"] = "IEX"
raw_to_stockCode["Idexx Laboratories"] = "IDXX"
raw_to_stockCode["Illinois Tool Works"] = "ITW"
raw_to_stockCode["Incyte"] = "INCY"
raw_to_stockCode["Ingersoll Rand"] = "IR"
raw_to_stockCode["Insulet Corporation"] = "PODD"
raw_to_stockCode["Intel"] = "INTC"
raw_to_stockCode["Intercontinental Exchange"] = "ICE"
raw_to_stockCode["International Flavors & Fragrances"] = "IFF"
raw_to_stockCode["International Paper"] = "IP"
raw_to_stockCode["Interpublic Group of Companies (The)"] = "IPG"
raw_to_stockCode["Intuit"] = "INTU"
raw_to_stockCode["Intuitive Surgical"] = "ISRG"
raw_to_stockCode["Invesco"] = "IVZ"
raw_to_stockCode["Invitation Homes"] = "INVH"
raw_to_stockCode["IQVIA"] = "IQV"
raw_to_stockCode["Iron Mountain"] = "IRM"
raw_to_stockCode["J.B. Hunt"] = "JBHT"
raw_to_stockCode["Jabil"] = "JBL"
raw_to_stockCode["Jack Henry & Associates"] = "JKHY"
raw_to_stockCode["Jacobs Solutions"] = "J"
raw_to_stockCode["Johnson & Johnson"] = "JNJ"
raw_to_stockCode["Johnson Controls"] = "JCI"
raw_to_stockCode["JPMorgan Chase"] = "JPM"
raw_to_stockCode["Juniper Networks"] = "JNPR"
raw_to_stockCode["Kellanova"] = "K"
raw_to_stockCode["Kenvue"] = "KVUE"
raw_to_stockCode["Keurig Dr Pepper"] = "KDP"
raw_to_stockCode["KeyCorp"] = "KEY"
raw_to_stockCode["Keysight"] = "KEYS"
raw_to_stockCode["Kimberly-Clark"] = "KMB"
raw_to_stockCode["Kimco Realty"] = "KIM"
raw_to_stockCode["Kinder Morgan"] = "KMI"
raw_to_stockCode["KKR"] = "KKR"
raw_to_stockCode["KLA Corporation"] = "KLAC"
raw_to_stockCode["Kraft Heinz"] = "KHC"
raw_to_stockCode["Kroger"] = "KR"
raw_to_stockCode["L3Harris"] = "LHX"
raw_to_stockCode["LabCorp"] = "LH"
raw_to_stockCode["Lam Research"] = "LRCX"
raw_to_stockCode["Lamb Weston"] = "LW"
raw_to_stockCode["Las Vegas Sands"] = "LVS"
raw_to_stockCode["Leidos"] = "LDOS"
raw_to_stockCode["Lennar"] = "LEN"
raw_to_stockCode["Lilly (Eli)"] = "LLY"
raw_to_stockCode["Linde plc"] = "LIN"
raw_to_stockCode["Live Nation Entertainment"] = "LYV"
raw_to_stockCode["LKQ Corporation"] = "LKQ"
raw_to_stockCode["Lockheed Martin"] = "LMT"
raw_to_stockCode["Loews Corporation"] = "L"
raw_to_stockCode["Lowe's"] = "LOW"
raw_to_stockCode["Lululemon Athletica"] = "LULU"
raw_to_stockCode["LyondellBasell"] = "LYB"
raw_to_stockCode["M&T Bank"] = "MTB"
raw_to_stockCode["Marathon Oil"] = "MRO"
raw_to_stockCode["Marathon Petroleum"] = "MPC"
raw_to_stockCode["MarketAxess"] = "MKTX"
raw_to_stockCode["Marriott International"] = "MAR"
raw_to_stockCode["Marsh McLennan"] = "MMC"
raw_to_stockCode["Martin Marietta Materials"] = "MLM"
raw_to_stockCode["Masco"] = "MAS"
raw_to_stockCode["Mastercard"] = "MA"
raw_to_stockCode["Match Group"] = "MTCH"
raw_to_stockCode["McCormick & Company"] = "MKC"
raw_to_stockCode["McDonald's"] = "MCD"
raw_to_stockCode["McKesson Corporation"] = "MCK"
raw_to_stockCode["Medtronic"] = "MDT"
raw_to_stockCode["Merck & Co."] = "MRK"
raw_to_stockCode["Meta Platforms"] = "META"
raw_to_stockCode["MetLife"] = "MET"
raw_to_stockCode["Mettler Toledo"] = "MTD"
raw_to_stockCode["MGM Resorts"] = "MGM"
raw_to_stockCode["Microchip Technology"] = "MCHP"
raw_to_stockCode["Micron Technology"] = "MU"
raw_to_stockCode["Microsoft"] = "MSFT"
raw_to_stockCode["Mid-America Apartment Communities"] = "MAA"
raw_to_stockCode["Moderna"] = "MRNA"
raw_to_stockCode["Mohawk Industries"] = "MHK"
raw_to_stockCode["Molina Healthcare"] = "MOH"
raw_to_stockCode["Molson Coors Beverage Company"] = "TAP"
raw_to_stockCode["Mondelez International"] = "MDLZ"
raw_to_stockCode["Monolithic Power Systems"] = "MPWR"
raw_to_stockCode["Monster Beverage"] = "MNST"
raw_to_stockCode["Moody's Corporation"] = "MCO"
raw_to_stockCode["Morgan Stanley"] = "MS"
raw_to_stockCode["Mosaic Company (The)"] = "MOS"
raw_to_stockCode["Motorola Solutions"] = "MSI"
raw_to_stockCode["MSCI"] = "MSCI"
raw_to_stockCode["Nasdaq, Inc."] = "NDAQ"
raw_to_stockCode["NetApp"] = "NTAP"
raw_to_stockCode["Netflix"] = "NFLX"
raw_to_stockCode["Newmont"] = "NEM"
raw_to_stockCode["News Corp"] = "NWS"
raw_to_stockCode["NextEra Energy"] = "NEE"
raw_to_stockCode["Nike, Inc."] = "NKE"
raw_to_stockCode["NiSource"] = "NI"
raw_to_stockCode["Nordson Corporation"] = "NDSN"
raw_to_stockCode["Norfolk Southern Railway"] = "NSC"
raw_to_stockCode["Northern Trust"] = "NTRS"
raw_to_stockCode["Northrop Grumman"] = "NOC"
raw_to_stockCode["Norwegian Cruise Line Holdings"] = "NCLH"
raw_to_stockCode["NRG Energy"] = "NRG"
raw_to_stockCode["Nucor"] = "NUE"
raw_to_stockCode["Nvidia"] = "NVDA"
raw_to_stockCode["NVR, Inc."] = "NVR"
raw_to_stockCode["NXP Semiconductors"] = "NXPI"
raw_to_stockCode["O'Reilly Auto Parts"] = "ORLY"
raw_to_stockCode["Occidental Petroleum"] = "OXY"
raw_to_stockCode["Old Dominion"] = "ODFL"
raw_to_stockCode["Omnicom Group"] = "OMC"
raw_to_stockCode["ON Semiconductor"] = "ON"
raw_to_stockCode["ONEOK"] = "OKE"
raw_to_stockCode["Oracle Corporation"] = "ORCL"
raw_to_stockCode["Otis Worldwide"] = "OTIS"
raw_to_stockCode["Paccar"] = "PCAR"
raw_to_stockCode["Packaging Corporation of America"] = "PKG"
raw_to_stockCode["Palo Alto Networks"] = "PANW"
raw_to_stockCode["Paramount Global"] = "PARA"
raw_to_stockCode["Parker Hannifin"] = "PH"
raw_to_stockCode["Paychex"] = "PAYX"
raw_to_stockCode["Paycom"] = "PAYC"
raw_to_stockCode["PayPal"] = "PYPL"
raw_to_stockCode["Pentair"] = "PNR"
raw_to_stockCode["PepsiCo"] = "PEP"
raw_to_stockCode["Pfizer"] = "PFE"
raw_to_stockCode["PG&E Corporation"] = "PCG"
raw_to_stockCode["Philip Morris International"] = "PM"
raw_to_stockCode["Phillips 66"] = "PSX"
raw_to_stockCode["Pinnacle West"] = "PNW"
raw_to_stockCode["PNC Financial Services"] = "PNC"
raw_to_stockCode["Pool Corporation"] = "POOL"
raw_to_stockCode["PPG Industries"] = "PPG"
raw_to_stockCode["PPL Corporation"] = "PPL"
raw_to_stockCode["Principal Financial Group"] = "PFG"
raw_to_stockCode["Procter & Gamble"] = "PG"
raw_to_stockCode["Progressive Corporation"] = "PGR"
raw_to_stockCode["Prologis"] = "PLD"
raw_to_stockCode["Prudential Financial"] = "PRU"
raw_to_stockCode["Public Service Enterprise Group"] = "PEG"
raw_to_stockCode["PTC"] = "PTC"
raw_to_stockCode["Public Storage"] = "PSA"
raw_to_stockCode["PulteGroup"] = "PHM"
raw_to_stockCode["Qorvo"] = "QRVO"
raw_to_stockCode["Quanta Services"] = "PWR"
raw_to_stockCode["Qualcomm"] = "QCOM"
raw_to_stockCode["Quest Diagnostics"] = "DGX"
raw_to_stockCode["Ralph Lauren Corporation"] = "RL"
raw_to_stockCode["Raymond James"] = "RJF"
raw_to_stockCode["RTX Corporation"] = "RTX"
raw_to_stockCode["Realty Income"] = "O"
raw_to_stockCode["Regency Centers"] = "REG"
raw_to_stockCode["Regeneron"] = "REGN"
raw_to_stockCode["Regions Financial Corporation"] = "RF"
raw_to_stockCode["Republic Services"] = "RSG"
raw_to_stockCode["ResMed"] = "RMD"
raw_to_stockCode["Revvity"] = "RVTY"
raw_to_stockCode["Rockwell Automation"] = "ROK"
raw_to_stockCode["Rollins, Inc."] = "ROL"
raw_to_stockCode["Roper Technologies"] = "ROP"
raw_to_stockCode["Ross Stores"] = "ROST"
raw_to_stockCode["Royal Caribbean Group"] = "RCL"
raw_to_stockCode["S&P Global"] = "SPGI"
raw_to_stockCode["Salesforce"] = "CRM"
raw_to_stockCode["SBA Communications"] = "SBAC"
raw_to_stockCode["Schlumberger"] = "SLB"
raw_to_stockCode["Seagate Technology"] = "STX"
raw_to_stockCode["Sempra"] = "SRE"
raw_to_stockCode["ServiceNow"] = "NOW"
raw_to_stockCode["Sherwin-Williams"] = "SHW"
raw_to_stockCode["Simon Property Group"] = "SPG"
raw_to_stockCode["Skyworks Solutions"] = "SWKS"
raw_to_stockCode["J.M. Smucker Company (The)"] = "SJM"
raw_to_stockCode["Smurfit WestRock"] = "SW"
raw_to_stockCode["Snap-on"] = "SNA"
raw_to_stockCode["Solventum"] = "SOLV"
raw_to_stockCode["Southern Company"] = "SO"
raw_to_stockCode["Southwest Airlines"] = "LUV"
raw_to_stockCode["Stanley Black & Decker"] = "SWK"
raw_to_stockCode["Starbucks"] = "SBUX"
raw_to_stockCode["State Street Corporation"] = "STT"
raw_to_stockCode["Steel Dynamics"] = "STLD"
raw_to_stockCode["Steris"] = "STE"
raw_to_stockCode["Stryker Corporation"] = "SYK"
raw_to_stockCode["Supermicro"] = "SMCI"
raw_to_stockCode["Synchrony Financial"] = "SYF"
raw_to_stockCode["Synopsys"] = "SNPS"
raw_to_stockCode["Sysco"] = "SYY"
raw_to_stockCode["T-Mobile US"] = "TMUS"
raw_to_stockCode["T. Rowe Price"] = "TROW"
raw_to_stockCode["Take-Two Interactive"] = "TTWO"
raw_to_stockCode["Tapestry, Inc."] = "TPR"
raw_to_stockCode["Targa Resources"] = "TRGP"
raw_to_stockCode["Target Corporation"] = "TGT"
raw_to_stockCode["TE Connectivity"] = "TEL"
raw_to_stockCode["Teledyne Technologies"] = "TDY"
raw_to_stockCode["Teleflex"] = "TFX"
raw_to_stockCode["Teradyne"] = "TER"
raw_to_stockCode["Tesla, Inc."] = "TSLA"
raw_to_stockCode["Texas Instruments"] = "TXN"
raw_to_stockCode["Textron"] = "TXT"
raw_to_stockCode["Thermo Fisher Scientific"] = "TMO"
raw_to_stockCode["TJX Companies"] = "TJX"
raw_to_stockCode["Tractor Supply"] = "TSCO"
raw_to_stockCode["Trane Technologies"] = "TT"
raw_to_stockCode["TransDigm Group"] = "TDG"
raw_to_stockCode["Travelers Companies (The)"] = "TRV"
raw_to_stockCode["Trimble Inc."] = "TRMB"
raw_to_stockCode["Truist"] = "TFC"
raw_to_stockCode["Tyler Technologies"] = "TYL"
raw_to_stockCode["Tyson Foods"] = "TSN"
raw_to_stockCode["U.S. Bank"] = "USB"
raw_to_stockCode["Uber"] = "UBER"
raw_to_stockCode["UDR, Inc."] = "UDR"
raw_to_stockCode["Ulta Beauty"] = "ULTA"
raw_to_stockCode["Union Pacific Corporation"] = "UNP"
raw_to_stockCode["United Airlines Holdings"] = "UAL"
raw_to_stockCode["United Parcel Service"] = "UPS"
raw_to_stockCode["United Rentals"] = "URI"
raw_to_stockCode["UnitedHealth Group"] = "UNH"
raw_to_stockCode["Universal Health Services"] = "UHS"
raw_to_stockCode["Valero Energy"] = "VLO"
raw_to_stockCode["Ventas"] = "VTR"
raw_to_stockCode["Veralto"] = "VLTO"
raw_to_stockCode["Verisign"] = "VRSN"
raw_to_stockCode["Verisk"] = "VRSK"
raw_to_stockCode["Verizon"] = "VZ"
raw_to_stockCode["Vertex Pharmaceuticals"] = "VRTX"
raw_to_stockCode["Viatris"] = "VTRS"
raw_to_stockCode["Vici Properties"] = "VICI"
raw_to_stockCode["Visa Inc."] = "V"
raw_to_stockCode["Vistra"] = "VST"
raw_to_stockCode["Vulcan Materials Company"] = "VMC"
raw_to_stockCode["W. R. Berkley Corporation"] = "WRB"
raw_to_stockCode["W. W. Grainger"] = "GWW"
raw_to_stockCode["Wabtec"] = "WAB"
raw_to_stockCode["Walgreens Boots Alliance"] = "WBA"
raw_to_stockCode["Walmart"] = "WMT"
raw_to_stockCode["Walt Disney Company (The)"] = "DIS"
raw_to_stockCode["Warner Bros. Discovery"] = "WBD"
raw_to_stockCode["Waste Management"] = "WM"
raw_to_stockCode["Waters Corporation"] = "WAT"
raw_to_stockCode["WEC Energy Group"] = "WEC"
raw_to_stockCode["Wells Fargo"] = "WFC"
raw_to_stockCode["Welltower"] = "WELL"
raw_to_stockCode["West Pharmaceutical Services"] = "WST"
raw_to_stockCode["Western Digital"] = "WDC"
raw_to_stockCode["Weyerhaeuser"] = "WY"
raw_to_stockCode["Williams Companies"] = "WMB"
raw_to_stockCode["Willis Towers Watson"] = "WTW"
raw_to_stockCode["Wynn Resorts"] = "WYNN"
raw_to_stockCode["Xcel Energy"] = "XEL"
raw_to_stockCode["Xylem Inc."] = "XYL"
raw_to_stockCode["Yum! Brands"] = "YUM"
raw_to_stockCode["Zebra Technologies"] = "ZBRA"
raw_to_stockCode["Zimmer Biomet"] = "ZBH"
raw_to_stockCode["Zoetis"] = "ZTS"
raw_to_stockCode

#Prepare the NER name to stockCode dictionary
NER_to_stockCode = {}
for company in raw_company_names:
  raw_name = company
  if(raw_name not in raw_to_NER):
    print("not in NER: ", raw_name)
    if(raw_name not in raw_to_stockCode):
      print("not in code: ", raw_name)
    continue
  if(raw_name not in raw_to_stockCode):
    print("not in code: ", raw_name)
    continue
  NER_name = raw_to_NER[raw_name]
  code = raw_to_stockCode[raw_name]
  NER_to_stockCode[raw_to_NER[company]] = raw_to_stockCode[company]
#NER_to_stockCode

#We only want articles about stocks we are monitering

def FoundCompany(ner_results):
  for index, entity in ner_results.items():
    NER_name = entity[0][3]
    if(NER_name in NER_to_stockCode):
      return NER_name;
  return ""

#As per the Grönberg's method we take the sentament of each sentence
#in the article, then return the mean of those sentaments

import nltk
import re
import statistics
from nltk.sentiment.vader import SentimentIntensityAnalyzer
nltk.download('vader_lexicon')
nltk.download('punkt_tab')
sentiment_analyzer = SentimentIntensityAnalyzer()

def Sentiment(sentence):
  score = sentiment_analyzer.polarity_scores(sentence)
  return score["compound"]

def DivideSentences(sentence):
  sentences = nltk.sent_tokenize(sentence)
  return sentences

def ArticleSentiment(article):
  sentences = nltk.sent_tokenize(article)
  scores = []
  for sentence in sentences:
    scores.append(Sentiment(sentence))
  return statistics.mean(scores)

#Run the NER and Sentiment analysis for each article
for index, row in newsdf.iterrows():
  text = {}
  text[row['title']] = (row['title'], [])
  hold = NER(text)
  subject = FoundCompany(hold)
  if(subject == ""):
    continue
  sentiment = ArticleSentiment(row['text'])
  date = row['published']
  code = NER_to_stockCode[subject]
  print("Title: ", row['title'], " Subject: ", subject,
        " Sentiment: ", sentiment, " Date: ", date,
        " Stock Code: ", code)